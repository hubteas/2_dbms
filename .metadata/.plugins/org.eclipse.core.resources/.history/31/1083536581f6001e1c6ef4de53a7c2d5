--회원제 게시판 프로젝트
CREATE TABLE TBL_USER(
	USER_NUMBER NUMBER,
	USER_ID VARCHAR2(100) NOT NULL UNIQUE,
	USER_PW VARCHAR2(100) NOT NULL,
	USER_NAME VARCHAR2(100) NOT NULL,
	USER_PHONE VARCHAR2(100) NOT NULL UNIQUE,
	USER_BIRTH DATE,
	USER_RECOMMENDERNUMBER NUMBER,
	CONSTRAINT PK_USER PRIMARY KEY(USER_NUMBER),
	CONSTRAINT FK_USER FOREIGN KEY(USER_RECOMMENDERNUMBER)
	REFERENCES TBL_USER(USER_NUMBER)
);

-- 프로젝트 전체에 시퀀스 하나만!
CREATE SEQUENCE SEQ_PRO;

INSERT INTO TBL_USER
(USER_NUMBER, USER_ID, USER_PW, USER_NAME, USER_PHONE, USER_BIRTH, USER_RECOMMENDERNUMBER)
VALUES(SEQ_PRO.NEXTVAL, 'hogeun', '4656', '류호근', '010-1111-1111', '2002-08-29', NULL);

-- 중복 검사 쿼리문.
SELECT COUNT(USER_ID) FROM TBL_USER
WHERE USER_ID = 'hogeun';

SELECT * FROM TBL_USER;

-- 내 정보를 보는데, 내가 추천한 사람의 아이디와 이름도 같이 확인!
SELECT T2.*, T1.USER_ID, T1.USER_NAME 
FROM TBL_USER T2 JOIN TBL_USER T1
ON T1.USER_NUMBER = T2.USER_RECOMMENDERNUMBER
WHERE T2.USER_NUMBER = 21;

-- MEMBERVO
CREATE TABLE TBL_OWNER(
   OWNER_NUMBER NUMBER,
   OWNER_NAME VARCHAR2(100) NOT NULL,
   OWNER_PHONE VARCHAR2(100) NOT NULL,
   CONSTRAINT PK_OWNER PRIMARY KEY(OWNER_NUMBER)
);

-- ANIMALVO
CREATE TABLE TBL_ANIMAL(
   ANIMAL_NUMBER NUMBER,
   ANIMAL_NAME VARCHAR2(100) NOT NULL,
   ANIMAL_SPECIES VARCHAR2(100),
   OWNER_NUMBER NUMBER,
   CONSTRAINT PK_ANIMAL PRIMARY KEY(ANIMAL_NUMBER),
   CONSTRAINT FK_ANIMAL FOREIGN KEY(OWNER_NUMBER)
   REFERENCES TBL_OWNER(OWNER_NUMBER)
);

CREATE TABLE TBL_CLINIC(
   CLINIC_NUMBER NUMBER,
   ANIMAL_NUMBER NUMBER,
   CLINIC_DISEASE VARCHAR2(100),
   CLINIC_TIME DATE NOT NULL, 
   CONSTRAINT PK_CLINIC PRIMARY KEY(CLINIC_NUMBER),
   CONSTRAINT FK_CLINIC FOREIGN KEY(ANIMAL_NUMBER)
   REFERENCES TBL_ANIMAL(ANIMAL_NUMBER)
);


-- PHONE 에 제약조건 추가
ALTER TABLE TBL_OWNER ADD CONSTRAINT UK_OWNER UNIQUE(OWNER_PHONE);


SELECT SEQ_PRO.NEXTVAL
FROM dual;

SELECT OWNER_NUMBER FROM TBL_OWNER
WHERE OWNER_name = '류호근' AND OWNER_PHONE = '010-1111-1111';

SELECT * FROM TBL_ANIMAL;

select animal_number from tbl_animal
where animal_name = '진순이' and owner_number = 43;

SELECT * FROM TBL_CLINIC;

INSERT INTO TBL_OWNER
(OWNER_NUMBER, OWNER_NAME, OWNER_PHONE)
VALUES(seq_pro.nextval, '관리자', '0000');


SELECT OWNER_NAME, T2.ANIMAL_NAME, ANIMAL_SPECIES, CLINIC_DISEASE, CLINIC_TIME FROM
TBL_OWNER T1 JOIN
   (SELECT ANIMAL_NAME, ANIMAL_SPECIES, CLINIC_DISEASE, OWNER_NUMBER, CLINIC_TIME  
   FROM TBL_ANIMAL a JOIN TBL_CLINIC b
   ON a.ANIMAL_NUMBER = b.ANIMAL_NUMBER
   WHERE TO_CHAR(CLINIC_TIME, 'YYYYMMDD') = TO_CHAR(sysdate, 'YYYYMMDD')) T2
ON T1.OWNER_NUMBER = T2.OWNER_NUMBER;

SELECT * FROM TBL_CLINIC
WHERE TO_CHAR(CLINIC_TIME, 'YYYYMMDD') = TO_CHAR(sysdate, 'YYYYMMDD');

DROP TABLE TBL_MEMBER CASCADE CONSTRAINT; -- FK 맺어져있는것까지 삭제






